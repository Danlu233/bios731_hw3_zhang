---
title: "final_report"
author: "Danlu Zhang"
date: "2025-03-02"
output: pdf_document
---
```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
knitr::opts_chunk$set(tidy = FALSE)
```
### Repo structure:  

1. **source folder** contains R functions used in the analysis:
    - 01_simulate_data.R: Simulates the dataset.
    - 02_apply_methods.R: Applies linear regression to the simulated data and do nonparametric bootstrap.
    - 03_extract_estimates.R: Extracts estimates and calculates Wald confidence intervals and bootstrap percentile intervals.

2. **simulation folder** contains the script that runs the simulation using the functions from the source Folder:
   - run_simulation.R: This script calls the functions in the Source Folder to perform the simulation.
   - run_sim.sh: Sbatch script for running run_simulation.R on cluster.

3. **data folder** stores the simulation results by scenario. The results generated by run_simulation.R are saved here.

4. **analysis folder** contains code for exploring the simulation results and generating the final report:
   - exploratory_analysis.R: Scripts for exploratory analysis of the simulation results, generating tables and figures.
   - final_report.Rmd: Code for generating final report.

5. **result folder** stores the tables and figures generated from the exploratory analysis. These files are used in the final report.

### Results summary

With the same true beta values, the normal error distribution resulted in smaller bias (Figure 1). The Monte Carlo standard errors (MCSE) of bias for the four scenarios were too small to be displayed in Figure 1. Across all four scenarios, the coverage of the Wald confidence interval was consistently higher than that of the bootstrap percentile interval, and the Wald confidence interval also had smaller MCSE for coverage (Figure 2). For $\beta_{treatment} = 0.5$, the error distribution did not impact the coverage but for $\beta_{treatment} = 0$, scenarios with normal error distribution had higher coverage. I calculated Type I error for scenarios with $\beta_{treatment} = 0$. Across error distribution, Wald confidence intervals has smaller Type I error than bootstrap percentile intervals while the MCSE of Type I error were similar between two methods (Figure 3, left panel). Power calculation was conducted for scenarios with $\beta_{treatment} = 0.5$. The Gamma error distribution yielded much higher power than the normal error distribution. Across both error distributions, the bootstrap percentile interval had higher power than the Wald confidence interval (Figure 3, right panel). Among the different methods for constructing confidence intervals, the Wald confidence interval took only 0.0004 seconds, while the nonparametric bootstrap percentile interval took 2.0579 seconds (Table 1).


```{r, echo = F, out.width="60%", fig.cap="Bias of estimated beta under varying true beta values and random error distributions.", fig.align="center"}
include_graphics(here::here("result","figure_for_bias.png"))
```


```{r, echo = F, out.width="70%", fig.align="center", fig.cap="Coverage based on Wald confidence intervals (lm) and nonparametric bootstrap percentile intervals (percentile) under varying true beta values and random error distributions. Black dashed line indicates 0.95 coverage."}

include_graphics(here::here("result","figure_for_coverage.png")) 

```


```{r, echo = F, out.width="70%", fig.align="center", fig.cap="Type I error for scenarios with true beta of 0 and power for scenarios with true beta of 0.5 based on Wald confidence intervals (lm) and nonparametric bootstrap percentile intervals (percentile) under varying true beta values and random error distributions. Top black dashed line indicates power at 0.8 and bottom black dashed line indicates Type I error at 0.05."}

include_graphics(here::here("result","figure_for_power.png"))

```

Table 1. Computation time in seconds of different methods for interval calculation.

| Computation Time (second) |                     Method                  |
|---------------------------|---------------------------------------------|
|          0.0004           |           Wald confidence interval          |
|          2.0579           | Nonparametric bootstrap percentile interval |






Git repo: https://github.com/Danlu233/bios731_hw3_zhang